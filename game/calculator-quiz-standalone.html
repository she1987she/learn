<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¨ˆç®—æ©Ÿè€ƒé¡Œæ¸¬é©—ï¼ˆç¨ç«‹ç‰ˆï¼‰ï½œMario ä¸»é¡ŒéŠæˆ²</title>
  <link rel="stylesheet" href="index.css">
</head>
<body class="mario-bg">
  <header class="mario-header">
    <button class="mario-btn mario-back" onclick="location.href='index.html'">è¿”å›éŠæˆ²é¦–é </button>
    <h1 class="mario-title">è¨ˆç®—æ©Ÿè€ƒé¡Œæ¸¬é©—</h1>
  </header>
  <main class="mario-main" style="text-align:center;max-width:800px;margin:0 auto;">
    <section class="mario-game-area mario-quiz-area" style="text-align:center;">
      <div style="margin-bottom:1.5rem;text-align:center;">
        <button class="mario-btn" onclick="startQuiz('easy')" style="margin:0 0.5rem;">ç°¡å–®æ¨¡å¼</button>
        <button class="mario-btn" onclick="startQuiz('normal')" style="margin:0 0.5rem;">æ™®é€šæ¨¡å¼</button>
        <button class="mario-btn" onclick="startQuiz('hard')" style="margin:0 0.5rem;">å›°é›£æ¨¡å¼</button>
      </div>
      <div id="quiz-container" style="text-align:center;">
        <div class="mario-quiz-block" style="text-align:center;margin:0 auto;">
          <h3>ğŸ¯ æº–å‚™é–‹å§‹æ¸¬é©—ï¼</h3>
          <p>è«‹é¸æ“‡é›£åº¦ï¼Œç„¶å¾Œé–‹å§‹æŒ‘æˆ°æ•¸å­¸é¡Œç›®ã€‚</p>
          <div class="mario-quiz-status" style="text-align:center;">
            <span class="mario-quiz-score">ç›®å‰åˆ†æ•¸ï¼š0 <span class="mario-coin">ğŸª™</span></span>
          </div>
        </div>
      </div>
      <div id="quiz-result" style="display:none;text-align:center;margin:0 auto;">
        <h2 class="mario-title">ğŸ‰ æ­å–œå®Œæˆï¼</h2>
        <div class="mario-quiz-status" style="font-size:1.5em;text-align:center;">
          <span class="mario-quiz-score">ç¸½åˆ†ï¼š<span id="final-score">0</span> <span class="mario-coin">ğŸª™</span></span>
        </div>
        <div id="clear-time-area" class="mario-quiz-status" style="text-align:center;"></div>
        <div id="save-score-area" style="margin:1.5rem 0;text-align:center;">
          <input type="text" id="player-name" placeholder="è¼¸å…¥ä½ çš„åå­—" class="mario-btn" style="width:160px;margin:0.5rem;">
          <button class="mario-btn" onclick="saveScore()" style="margin:0.5rem;">å„²å­˜åˆ†æ•¸</button>
        </div>
        <button class="mario-btn" onclick="location.reload()" style="margin:0.5rem;">å†ç©ä¸€æ¬¡</button>
      </div>
    </section>
    <section class="mario-leaderboard" id="leaderboard-section" style="text-align:center;margin:2rem auto;">
      <h2 class="mario-subtitle">æ’è¡Œæ¦œ</h2>
      <ul id="leaderboard-list" style="text-align:center;">
        <!-- æ’è¡Œæ¦œå…§å®¹ç”± JS ç”¢ç”Ÿ -->
      </ul>
    </section>
  </main>

<script>
// å…¨åŸŸè®Šæ•¸
let currentQuiz = 0;
let gameScore = 0;
let gameStartTime = null;
let quizQuestions = [];
let currentDifficulty = 'normal';

// ç”Ÿæˆé¡Œç›®
function generateQuestions(difficulty = 'normal', count = 10) {
  const questions = [];
  let maxNumber = 10;
  
  if (difficulty === 'easy') maxNumber = 10;
  else if (difficulty === 'normal') maxNumber = 20;
  else if (difficulty === 'hard') maxNumber = 50;
  
  for (let i = 0; i < count; i++) {
    const operations = ['+', '-', 'Ã—', 'Ã·'];
    const op = operations[Math.floor(Math.random() * operations.length)];
    
    let num1 = Math.floor(Math.random() * maxNumber) + 1;
    let num2 = Math.floor(Math.random() * maxNumber) + 1;
    
    // ç¢ºä¿é™¤æ³•èƒ½æ•´é™¤
    if (op === 'Ã·') {
      num1 = num1 * num2;
    }
    
    // ç¢ºä¿æ¸›æ³•ä¸ç‚ºè² æ•¸
    if (op === '-' && num1 < num2) {
      [num1, num2] = [num2, num1];
    }
    
    let correctAnswer;
    switch (op) {
      case '+': correctAnswer = num1 + num2; break;
      case '-': correctAnswer = num1 - num2; break;
      case 'Ã—': correctAnswer = num1 * num2; break;
      case 'Ã·': correctAnswer = num1 / num2; break;
    }
    
    // ç”ŸæˆéŒ¯èª¤é¸é …
    const options = [correctAnswer];
    while (options.length < 4) {
      const wrongAnswer = correctAnswer + Math.floor(Math.random() * 20) - 10;
      if (wrongAnswer > 0 && !options.includes(wrongAnswer)) {
        options.push(wrongAnswer);
      }
    }
    
    // éš¨æ©Ÿæ’åºé¸é …
    options.sort(() => Math.random() - 0.5);
    
    questions.push({
      question: `${num1} ${op} ${num2} = ?`,
      options: options,
      correctIndex: options.indexOf(correctAnswer)
    });
  }
  
  return questions;
}

// é–‹å§‹æ¸¬é©—
function startQuiz(difficulty) {
  console.log('é–‹å§‹æ¸¬é©—ï¼Œé›£åº¦:', difficulty);
  
  currentDifficulty = difficulty;
  currentQuiz = 0;
  gameScore = 0;
  gameStartTime = Date.now();
  
  quizQuestions = generateQuestions(difficulty, 10);
  
  document.getElementById('quiz-result').style.display = 'none';
  showCurrentQuestion();
}

// é¡¯ç¤ºç•¶å‰å•é¡Œ
function showCurrentQuestion() {
  if (currentQuiz >= quizQuestions.length) {
    showResult();
    return;
  }
  
  const question = quizQuestions[currentQuiz];
  const container = document.getElementById('quiz-container');
  
  container.innerHTML = `
    <div class="mario-quiz-block">
      <div class="mario-quiz-question">
        <span class="mario-quiz-qnum">ç¬¬ ${currentQuiz + 1} é¡Œ</span>
        <span class="mario-quiz-qtext">${question.question}</span>
      </div>
      <div class="mario-quiz-options">
        ${question.options.map((option, index) => 
          `<button class="mario-btn mario-option" onclick="selectAnswer(${index})">${option}</button>`
        ).join('')}
      </div>
      <div class="mario-quiz-status">
        <span class="mario-quiz-score">åˆ†æ•¸ï¼š${gameScore} <span class="mario-coin">ğŸª™</span></span>
      </div>
    </div>
  `;
}

// é¸æ“‡ç­”æ¡ˆ
function selectAnswer(selectedIndex) {
  const question = quizQuestions[currentQuiz];
  const buttons = document.querySelectorAll('.mario-option');
  
  // ç¦ç”¨æ‰€æœ‰æŒ‰éˆ•
  buttons.forEach(btn => btn.disabled = true);
  
  if (selectedIndex === question.correctIndex) {
    buttons[selectedIndex].style.backgroundColor = '#4CAF50';
    gameScore += 10;
    console.log('ç­”å°äº†ï¼ç•¶å‰åˆ†æ•¸:', gameScore);
  } else {
    buttons[selectedIndex].style.backgroundColor = '#f44336';
    buttons[question.correctIndex].style.backgroundColor = '#4CAF50';
    console.log('ç­”éŒ¯äº†ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯:', question.options[question.correctIndex]);
  }
  
  // æ›´æ–°åˆ†æ•¸é¡¯ç¤º
  document.querySelector('.mario-quiz-score').innerHTML = `åˆ†æ•¸ï¼š${gameScore} <span class="mario-coin">ğŸª™</span>`;
  
  // 1.5ç§’å¾Œé¡¯ç¤ºä¸‹ä¸€é¡Œ
  setTimeout(() => {
    currentQuiz++;
    showCurrentQuestion();
  }, 1500);
}

// é¡¯ç¤ºçµæœ
function showResult() {
  const endTime = Date.now();
  const duration = Math.round((endTime - gameStartTime) / 1000);
  
  document.getElementById('quiz-container').style.display = 'none';
  document.getElementById('final-score').textContent = gameScore;
  document.getElementById('clear-time-area').innerHTML = `é€šé—œæ™‚é–“ï¼š${duration} ç§’ <span class="mario-coin">â±ï¸</span>`;
  document.getElementById('quiz-result').style.display = 'block';
  
  console.log('æ¸¬é©—å®Œæˆï¼æœ€çµ‚åˆ†æ•¸:', gameScore, 'æ™‚é–“:', duration, 'ç§’');
  loadLeaderboard();
}

// å„²å­˜åˆ†æ•¸
function saveScore() {
  const nameInput = document.getElementById('player-name');
  const playerName = nameInput.value.trim();
  
  if (!playerName) {
    alert('è«‹è¼¸å…¥ä½ çš„åå­—ï¼');
    return;
  }
  
  const timeText = document.getElementById('clear-time-area').textContent;
  const leaderboard = getLeaderboard();
  
  leaderboard.push({
    player: playerName,
    score: gameScore,
    time: Date.now(),
    clearTime: timeText
  });
  
  localStorage.setItem('mario_quiz_leaderboard', JSON.stringify(leaderboard));
  loadLeaderboard();
  
  nameInput.disabled = true;
  nameInput.nextElementSibling.textContent = 'å·²å„²å­˜';
  nameInput.nextElementSibling.disabled = true;
}

// å–å¾—æ’è¡Œæ¦œ
function getLeaderboard() {
  const data = localStorage.getItem('mario_quiz_leaderboard');
  return data ? JSON.parse(data) : [];
}

// è¼‰å…¥æ’è¡Œæ¦œ
function loadLeaderboard() {
  const leaderboard = getLeaderboard();
  const list = document.getElementById('leaderboard-list');
  
  if (leaderboard.length === 0) {
    list.innerHTML = '<li>é‚„æ²’æœ‰åˆ†æ•¸ç´€éŒ„</li>';
    return;
  }
  
  leaderboard.sort((a, b) => b.score - a.score);
  list.innerHTML = leaderboard
    .slice(0, 10)
    .map(item => `<li>${item.player} ${item.score}åˆ† <span style="color:#888;font-size:0.9em;">${item.clearTime || ''}</span></li>`)
    .join('');
}

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
  console.log('è¨ˆç®—æ©Ÿè€ƒé¡Œæ¸¬é©—è¼‰å…¥å®Œæˆ');
  loadLeaderboard();
});
</script>
</body>
</html>

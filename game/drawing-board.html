<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¡—é´‰æ¿ï½œMario ä¸»é¡ŒéŠæˆ²</title>
  <link rel="stylesheet" href="index.css">
</head>
<body class="mario-bg">
  <header class="mario-header">
    <button class="mario-btn mario-back" onclick="location.href='index.html'">è¿”å›éŠæˆ²é¦–é </button>
    <h1 class="mario-title">å¡—é´‰æ¿</h1>
  </header>
  <main class="mario-main">
    <section class="mario-game-area">
      <p class="mario-desc">Mario ä¸»é¡Œåƒç´ å¡—é´‰ï¼Œç™¼æ®å‰µæ„ï¼</p>
      <div id="drawing-board" style="margin:2rem auto;text-align:center;"></div>
      <div id="drawing-result" style="display:none;text-align:center;"></div>
    </section>
    <section class="mario-leaderboard">
      <h2 class="mario-subtitle">æ’è¡Œæ¦œ</h2>
      <ul id="leaderboard-list"></ul>
    </section>
    <div id="save-score-area" style="margin:1.5rem 0;text-align:center;"></div>
  </main>
  <script src="mario-common.js"></script>
  <script>
  // Mario ä¸»é¡Œåƒç´ å¡—é´‰æ¿
  const GRID_SIZE = 16;
  const colors = ['#e63946','#f7b731','#457b9d','#43aa8b','#b97a1a','#7ec0ee','#c0392b','#ffe066','#222','#fff'];
  let currentColor = colors[0];
  let grid = Array.from({length: GRID_SIZE}, () => Array(GRID_SIZE).fill('#fff'));
  let isDrawing = false;
  
  function renderDrawingBoard() {
    let html = '<div style="text-align:center;">';
    
    // èª¿è‰²ç›¤
    html += '<div style="margin-bottom:1em;">é¡è‰²ï¼š';
    colors.forEach(color => {
      html += `<button style="width:30px;height:30px;background:${color};border:2px solid ${currentColor===color?'#222':'#ccc'};margin:2px;border-radius:4px;" onclick="currentColor='${color}';renderDrawingBoard()"></button>`;
    });
    html += '</div>';
    
    // ç•«å¸ƒ
    html += '<div style="display:inline-block;border:2px solid #222;background:#fff;">';
    for(let y=0;y<GRID_SIZE;y++){
      html += '<div style="display:flex;">';
      for(let x=0;x<GRID_SIZE;x++){
        html += `<div style="width:20px;height:20px;background:${grid[y][x]};border:1px solid #ddd;cursor:pointer;" 
                 onmousedown="startDraw(${x},${y})" 
                 onmouseover="if(isDrawing)draw(${x},${y})" 
                 onmouseup="stopDraw()"></div>`;
      }
      html += '</div>';
    }
    html += '</div>';
    
    // åŠŸèƒ½æŒ‰éˆ•
    html += '<div style="margin-top:1em;">';
    html += '<button class="mario-btn" onclick="clearGrid()">æ¸…é™¤</button>';
    html += '<button class="mario-btn" onclick="saveDrawing()">å®Œæˆä½œå“</button>';
    html += '</div>';
    
    html += '</div>';
    document.getElementById('drawing-board').innerHTML = html;
  }
  
  function startDraw(x, y) {
    if(startTime === null) startTime = Date.now();
    isDrawing = true;
    draw(x, y);
  }
  
  function draw(x, y) {
    grid[y][x] = currentColor;
    renderDrawingBoard();
  }
  
  function stopDraw() {
    isDrawing = false;
  }
  
  function clearGrid() {
    grid = Array.from({length: GRID_SIZE}, () => Array(GRID_SIZE).fill('#fff'));
    renderDrawingBoard();
  }
  
  function saveDrawing() {
    endTime = Date.now();
    showResult();
  }
  
  // é˜²æ­¢é¸å–æ–‡å­—
  document.addEventListener('selectstart', e => e.preventDefault());
  
  renderDrawingBoard();
  let startTime = null;
  let endTime = null;
  function showResult() {
    let timeSec = Math.round((endTime-startTime)/1000);
    let timeStr = timeSec<60?`${timeSec}ç§’`:`${Math.floor(timeSec/60)}åˆ†${timeSec%60}ç§’`;
    document.getElementById('drawing-result').style.display='block';
    document.getElementById('drawing-result').innerHTML = `<h2 class='mario-title'>å®Œæˆï¼</h2><div class='mario-quiz-status'>é€šé—œæ™‚é–“ï¼š<span>${timeStr}</span> <span class='mario-coin'>â±ï¸</span></div><button class='mario-btn' onclick='location.reload()'>å†ç©ä¸€æ¬¡</button>`;
    renderPlayerSelect('save-score-area', function(player) {
      let list = getLeaderboard();
      list.push({ player, score: timeSec, time: Date.now(), clearTime: timeStr });
      saveLeaderboard(list);
      renderLeaderboard();
    });
  }
  const leaderboardKey = 'drawing_board_leaderboard';
  function getLeaderboard() {
    let data = localStorage.getItem(leaderboardKey);
    if (!data) return [];
    try { return JSON.parse(data); } catch { return []; }
  }
  function saveLeaderboard(list) {
    localStorage.setItem(leaderboardKey, JSON.stringify(list));
  }
  function renderLeaderboard() {
    const list = getLeaderboard();
    const ul = document.getElementById('leaderboard-list');
    if (!ul) return;
    const rankIcons = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
    ul.innerHTML = list
      .sort((a, b) => a.score - b.score)
      .map((item, idx) => {
        const icon = rankIcons[idx] || `<span style='font-weight:bold;'>${idx+1}</span>`;
        return `<li>${icon} ${item.player} ${item.clearTime?item.clearTime:item.score+'ç§’'}</li>`;
      })
      .join('');
  }
  renderLeaderboard();
  </script>
</body>
</html>

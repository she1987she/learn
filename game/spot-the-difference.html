<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ‰¾ä¸åŒï½œMario ä¸»é¡ŒéŠæˆ²</title>
  <link rel="stylesheet" href="index.css">
</head>
<body class="mario-bg">
  <header class="mario-header">
    <button class="mario-btn mario-back" onclick="location.href='index.html'">è¿”å›éŠæˆ²é¦–é </button>
    <h1 class="mario-title">æ‰¾ä¸åŒ</h1>
  </header>
  <main class="mario-main">
    <section class="mario-game-area">
      <p class="mario-desc">æ‰¾å‡ºå…©å¼µ Mario åœ–ç‰‡çš„ä¸åŒè™•ï¼Œè€ƒé©—è§€å¯ŸåŠ›ï¼</p>
      <div id="spot-board" style="margin:2rem auto;text-align:center;"></div>
      <div id="spot-result" style="display:none;text-align:center;"></div>
    </section>
    <section class="mario-leaderboard">
      <h2 class="mario-subtitle">æ’è¡Œæ¦œ</h2>
      <ul id="leaderboard-list"></ul>
    </section>
    <div id="save-score-area" style="margin:1.5rem 0;text-align:center;"></div>
  </main>
  <script src="mario-common.js"></script>
  <script>
  // æ‰¾ä¸åŒéŠæˆ²éš¨æ©Ÿç”Ÿæˆ
  function generateSpotGame() {
    const icons = ['ğŸ„','â­','ğŸŒ¸','ğŸª™','ğŸ§±','ğŸš©','ğŸ”¥','ğŸ‘‘','ğŸ’'];
    const size = 6; // 6x6 æ ¼å­
    const board1 = [];
    const board2 = [];
    const differences = [];
    
    // ç”ŸæˆåŸºç¤åœ–æ¡ˆ
    for(let y=0;y<size;y++){
      board1[y] = [];
      board2[y] = [];
      for(let x=0;x<size;x++){
        const icon = icons[Math.floor(Math.random() * icons.length)];
        board1[y][x] = icon;
        board2[y][x] = icon;
      }
    }
    
    // éš¨æ©Ÿç”Ÿæˆ3-5å€‹ä¸åŒé»
    const diffCount = Math.floor(Math.random() * 3) + 3;
    for(let i=0;i<diffCount;i++){
      let x, y;
      do {
        x = Math.floor(Math.random() * size);
        y = Math.floor(Math.random() * size);
      } while(differences.some(d => d.x===x && d.y===y));
      
      board2[y][x] = icons[Math.floor(Math.random() * icons.length)];
      differences.push({x, y, found: false});
    }
    
    return {board1, board2, differences};
  }
  
  const gameData = generateSpotGame();
  let foundCount = 0;
  
  function renderSpotBoard() {
    let html = '<div style="display:flex;gap:20px;justify-content:center;">';
    
    // å·¦é‚Šåœ–
    html += '<div><h3>åœ–ä¸€</h3><div style="display:grid;grid-template-columns:repeat(6,40px);gap:2px;">';
    for(let y=0;y<6;y++){
      for(let x=0;x<6;x++){
        html += `<div style="width:40px;height:40px;display:flex;align-items:center;justify-content:center;font-size:1.5rem;background:#fffbe6;border:1px solid #e09c3a;border-radius:4px;">${gameData.board1[y][x]}</div>`;
      }
    }
    html += '</div></div>';
    
    // å³é‚Šåœ–ï¼ˆå¯é»æ“Šï¼‰
    html += '<div><h3>åœ–äºŒ</h3><div style="display:grid;grid-template-columns:repeat(6,40px);gap:2px;">';
    for(let y=0;y<6;y++){
      for(let x=0;x<6;x++){
        const isDiff = gameData.differences.find(d => d.x===x && d.y===y);
        const isFound = isDiff && isDiff.found;
        html += `<button class="mario-btn" style="width:40px;height:40px;font-size:1.5rem;background:${isFound?'#ffe066':'#fffbe6'};" data-x="${x}" data-y="${y}">${gameData.board2[y][x]}</button>`;
      }
    }
    html += '</div></div>';
    
    html += '</div>';
    html += `<div style="margin:1em 0;font-size:1.2em;color:#e63946;">å·²æ‰¾åˆ°ï¼š${foundCount}/${gameData.differences.length}</div>`;
    
    document.getElementById('spot-board').innerHTML = html;
    
    // ç¶å®šé»æ“Šäº‹ä»¶
    Array.from(document.querySelectorAll('#spot-board button')).forEach(btn => {
      btn.onclick = function() {
        if(startTime === null) startTime = Date.now();
        const x = parseInt(this.dataset.x);
        const y = parseInt(this.dataset.y);
        const diff = gameData.differences.find(d => d.x===x && d.y===y);
        
        if(diff && !diff.found) {
          diff.found = true;
          foundCount++;
          this.style.background = '#ffe066';
          
          if(foundCount === gameData.differences.length) {
            endTime = Date.now();
            showResult();
          } else {
            renderSpotBoard();
          }
        }
      };
    });
  }
  
  renderSpotBoard();
  let startTime = null;
  let endTime = null;
  function showResult() {
    let timeSec = Math.round((endTime-startTime)/1000);
    let timeStr = timeSec<60?`${timeSec}ç§’`:`${Math.floor(timeSec/60)}åˆ†${timeSec%60}ç§’`;
    document.getElementById('spot-result').style.display='block';
    document.getElementById('spot-result').innerHTML = `<h2 class='mario-title'>å®Œæˆï¼</h2><div class='mario-quiz-status'>é€šé—œæ™‚é–“ï¼š<span>${timeStr}</span> <span class='mario-coin'>â±ï¸</span></div><button class='mario-btn' onclick='location.reload()'>å†ç©ä¸€æ¬¡</button>`;
    renderPlayerSelect('save-score-area', function(player) {
      let list = getLeaderboard();
      list.push({ player, score: timeSec, time: Date.now(), clearTime: timeStr });
      saveLeaderboard(list);
      renderLeaderboard();
    });
  }
  const leaderboardKey = 'spot_diff_leaderboard';
  function getLeaderboard() {
    let data = localStorage.getItem(leaderboardKey);
    if (!data) return [];
    try { return JSON.parse(data); } catch { return []; }
  }
  function saveLeaderboard(list) {
    localStorage.setItem(leaderboardKey, JSON.stringify(list));
  }
  function renderLeaderboard() {
    const list = getLeaderboard();
    const ul = document.getElementById('leaderboard-list');
    if (!ul) return;
    const rankIcons = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
    ul.innerHTML = list
      .sort((a, b) => a.score - b.score)
      .map((item, idx) => {
        const icon = rankIcons[idx] || `<span style='font-weight:bold;'>${idx+1}</span>`;
        return `<li>${icon} ${item.player} ${item.clearTime?item.clearTime:item.score+'ç§’'}</li>`;
      })
      .join('');
  }
  renderLeaderboard();
  </script>
</body>
</html>

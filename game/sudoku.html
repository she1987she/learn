<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ•¸ç¨ï½œMario ä¸»é¡ŒéŠæˆ²</title>
  <link rel="stylesheet" href="index.css">
</head>
<body class="mario-bg">
  <header class="mario-header">
    <button class="mario-btn mario-back" onclick="location.href='index.html'">è¿”å›éŠæˆ²é¦–é </button>
    <h1 class="mario-title">æ•¸ç¨</h1>
  </header>
  <main class="mario-main">
    <section class="mario-game-area">
      <p class="mario-desc">Mario ä¸»é¡Œæ•¸ç¨ï¼ŒæŒ‘æˆ°ä½ çš„é‚è¼¯åŠ›ï¼</p>
      <div id="sudoku-board" style="margin:2rem auto;text-align:center;"></div>
      <div id="sudoku-result" style="display:none;text-align:center;"></div>
    </section>
    <section class="mario-leaderboard">
      <h2 class="mario-subtitle">æ’è¡Œæ¦œ</h2>
      <ul id="leaderboard-list"></ul>
    </section>
    <div id="save-score-area" style="margin:1.5rem 0;text-align:center;"></div>
  </main>
  <script src="mario-common.js"></script>
  <script>
  // æ•¸ç¨éš¨æ©Ÿç”Ÿæˆèˆ‡ä¸»ç¨‹å¼
  function generateSudoku() {
    // ç°¡åŒ–æ•¸ç¨ç”Ÿæˆï¼šé è¨­å¹¾å€‹æ¨¡æ¿éš¨æ©Ÿé¸æ“‡
    const templates = [
      [
        [5,3,0,0,7,0,0,0,0],
        [6,0,0,1,9,5,0,0,0],
        [0,9,8,0,0,0,0,6,0],
        [8,0,0,0,6,0,0,0,3],
        [4,0,0,8,0,3,0,0,1],
        [7,0,0,0,2,0,0,0,6],
        [0,6,0,0,0,0,2,8,0],
        [0,0,0,4,1,9,0,0,5],
        [0,0,0,0,8,0,0,7,9]
      ],
      [
        [0,0,0,6,0,0,4,0,0],
        [7,0,0,0,0,3,6,0,0],
        [0,0,0,0,9,1,0,8,0],
        [0,0,0,0,0,0,0,0,0],
        [0,5,0,1,8,0,0,0,3],
        [0,0,0,3,0,6,0,4,5],
        [0,4,0,2,0,0,0,6,0],
        [9,0,3,0,0,0,0,0,0],
        [0,2,0,0,0,0,1,0,0]
      ]
    ];
    return templates[Math.floor(Math.random() * templates.length)];
  }
  const sudokuBoard = generateSudoku().map(row => [...row]);
  const originalBoard = generateSudoku().map(row => [...row]);
  
  function renderSudoku() {
    let html = '<div style="display:grid;grid-template-columns:repeat(9,35px);gap:1px;justify-content:center;background:#222;padding:2px;">';
    for(let y=0;y<9;y++){
      for(let x=0;x<9;x++){
        const val = sudokuBoard[y][x];
        const isOriginal = originalBoard[y][x] !== 0;
        html += `<input type="number" min="1" max="9" value="${val||''}" 
                 style="width:35px;height:35px;text-align:center;border:none;background:${isOriginal?'#f0f0f0':'#fff'};font-size:1rem;"
                 ${isOriginal?'readonly':''} data-x="${x}" data-y="${y}">`;
      }
    }
    html += '</div>';
    document.getElementById('sudoku-board').innerHTML = html;
    
    // ç¶å®šè¼¸å…¥äº‹ä»¶
    Array.from(document.querySelectorAll('#sudoku-board input')).forEach(input => {
      input.onchange = function() {
        const x = parseInt(this.dataset.x);
        const y = parseInt(this.dataset.y);
        sudokuBoard[y][x] = parseInt(this.value) || 0;
        if(checkWin()) {
          endTime = Date.now();
          showResult();
        }
      };
    });
  }
  
  function checkWin() {
    // æª¢æŸ¥æ˜¯å¦å®Œæˆ
    for(let y=0;y<9;y++){
      for(let x=0;x<9;x++){
        if(sudokuBoard[y][x] === 0) return false;
      }
    }
    return true;
  }
  
  renderSudoku();
  let startTime = null;
  let endTime = null;
  function showResult() {
    let timeSec = Math.round((endTime-startTime)/1000);
    let timeStr = timeSec<60?`${timeSec}ç§’`:`${Math.floor(timeSec/60)}åˆ†${timeSec%60}ç§’`;
    document.getElementById('sudoku-result').style.display='block';
    document.getElementById('sudoku-result').innerHTML = `<h2 class='mario-title'>å®Œæˆï¼</h2><div class='mario-quiz-status'>é€šé—œæ™‚é–“ï¼š<span>${timeStr}</span> <span class='mario-coin'>â±ï¸</span></div><button class='mario-btn' onclick='location.reload()'>å†ç©ä¸€æ¬¡</button>`;
    renderPlayerSelect('save-score-area', function(player) {
      let list = getLeaderboard();
      list.push({ player, score: timeSec, time: Date.now(), clearTime: timeStr });
      saveLeaderboard(list);
      renderLeaderboard();
    });
  }
  const leaderboardKey = 'sudoku_leaderboard';
  function getLeaderboard() {
    let data = localStorage.getItem(leaderboardKey);
    if (!data) return [];
    try { return JSON.parse(data); } catch { return []; }
  }
  function saveLeaderboard(list) {
    localStorage.setItem(leaderboardKey, JSON.stringify(list));
  }
  function renderLeaderboard() {
    const list = getLeaderboard();
    const ul = document.getElementById('leaderboard-list');
    if (!ul) return;
    const rankIcons = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
    ul.innerHTML = list
      .sort((a, b) => a.score - b.score)
      .map((item, idx) => {
        const icon = rankIcons[idx] || `<span style='font-weight:bold;'>${idx+1}</span>`;
        return `<li>${icon} ${item.player} ${item.clearTime?item.clearTime:item.score+'ç§’'}</li>`;
      })
      .join('');
  }
  renderLeaderboard();
  </script>
</body>
</html>
